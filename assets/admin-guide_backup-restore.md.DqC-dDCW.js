import{_ as a,c as i,o as n,ag as e}from"./chunks/framework.DI3H4yZc.js";const F=JSON.parse('{"title":"Backup and Restore Guide","description":"","frontmatter":{},"headers":[],"relativePath":"admin-guide/backup-restore.md","filePath":"admin-guide/backup-restore.md"}'),t={name:"admin-guide/backup-restore.md"};function l(p,s,k,h,r,o){return n(),i("div",null,s[0]||(s[0]=[e(`<h1 id="backup-and-restore-guide" tabindex="-1">Backup and Restore Guide <a class="header-anchor" href="#backup-and-restore-guide" aria-label="Permalink to &quot;Backup and Restore Guide&quot;">​</a></h1><p>Regular backups are essential for protecting your Kioskmanager data against accidental loss, corruption, or system failures. This guide outlines procedures for backing up and restoring the Kioskmanager database (PostgreSQL) and media files (stored on a Persistent Volume Claim).</p><h2 id="overview" tabindex="-1">Overview <a class="header-anchor" href="#overview" aria-label="Permalink to &quot;Overview&quot;">​</a></h2><p>Kioskmanager data consists of two main parts:</p><ol><li><strong>Database:</strong> Stores all configuration, content metadata, user information, display group assignments, playlists, etc. Managed by PostgreSQL.</li><li><strong>Media Files:</strong> Uploaded videos are stored on a Persistent Volume Claim (PVC).</li></ol><p>Both components must be backed up and restored together to ensure data consistency.</p><h2 id="restoring-database-backups" tabindex="-1">Restoring Database Backups <a class="header-anchor" href="#restoring-database-backups" aria-label="Permalink to &quot;Restoring Database Backups&quot;">​</a></h2><p>Kioskmanager has a Kubernetes CronJob Ressource by default which does daily backups and keep up to 10 of them. Please refer to Readme.md for further details. The automated backup system stores SQL dumps in a dedicated PersistentVolumeClaim. To restore a backup:</p><ol><li>List available backups:</li></ol><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Create a temporary pod to list backups</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> list-backups</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --rm</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -i</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --tty</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --image=bitnami/postgresql</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --volumes=backup-vol:/backups</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --overrides=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;{</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;spec&quot;: {</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      &quot;volumes&quot;: [{</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &quot;name&quot;: &quot;backup-vol&quot;,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &quot;persistentVolumeClaim&quot;: {&quot;claimName&quot;: &quot;kioskmanager-backup&quot;}</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      }]</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    }</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  }&#39;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ls</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -l</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /backups</span></span></code></pre></div><ol start="2"><li>Restore a specific backup:</li></ol><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Replace BACKUP_FILE with the desired backup file name from the list</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> restore-backup</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --rm</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -i</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --tty</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --image=bitnami/postgresql</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --env=PGPASSWORD=$(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> get</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> secret</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kioskmanager-postgresql</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -o </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">jsonpath=&quot;{.data.password}&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> base64</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -d)</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --volumes=backup-vol:/backups</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --overrides=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;{</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;spec&quot;: {</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      &quot;volumes&quot;: [{</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &quot;name&quot;: &quot;backup-vol&quot;,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &quot;persistentVolumeClaim&quot;: {&quot;claimName&quot;: &quot;kioskmanager-backup&quot;}</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      }]</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    }</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  }&#39;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> psql</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -h</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kioskmanager-postgresql</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">         -U</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> taskkioskmanagerpostgres</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">         -d</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dbkioskmanager</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">         -f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /backups/BACKUP_FILE</span></span></code></pre></div><blockquote><p><strong>Note</strong>: Replace <code>kioskmanager-backup</code>, <code>kioskmanager-postgresql</code>, and other values according to your release name and configuration.</p></blockquote><h3 id="important-considerations" tabindex="-1">Important Considerations <a class="header-anchor" href="#important-considerations" aria-label="Permalink to &quot;Important Considerations&quot;">​</a></h3><ul><li>The restore process will overwrite existing database content</li><li>Ensure no active writes are happening during restore</li><li>Consider scaling down the application during restore:<div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> scale</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> deployment</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kioskmanager</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --replicas=0</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ... perform restore ...</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> scale</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> deployment</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kioskmanager</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --replicas=1</span></span></code></pre></div></li><li>Match the backup with the corresponding media files backup to maintain consistency</li></ul>`,15)]))}const c=a(t,[["render",l]]);export{F as __pageData,c as default};
